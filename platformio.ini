[env:esp32-s3-devkitc-1]
# IMPORTANT: we pin to a recent `platform-espressif32` because older releases
# (e.g. 6.3.x) do not detect `data,littlefs` partitions for `buildfs/uploadfs`.
# That older behavior silently encouraged building a LittleFS image into a
# `data,spiffs` partition, which can confuse external tools (e.g. ESPConnect).
platform = espressif32@6.12.0
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
board_build.partitions = partitions_firmware_fs_8MB.csv
board_build.filesystem = littlefs

# Workaround: esptool 4.9.0 package in some PlatformIO setups can be missing the
# `intelhex` Python dependency (causes `pio run` to fail at import time).
# Pin to a known-good tool-esptoolpy bundle.
platform_packages =
    platformio/tool-esptoolpy@1.40501.0

# Add custom targets:
# - `buildfwfs`  -> build LittleFS image for the `fwfs` partition (subtype 0x83)
# - `uploadfwfs` -> flash that image to the correct offset
extra_scripts =
    post:tools/pio_fwfs_targets.py
build_flags =
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DARDUINO_USB_MODE=1
